---
title: "Draft Research pt3"
author: "Tom Kain"
date: "March 11, 2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tidyverse.quiet=TRUE)
library(tidyverse)
library(fuzzyjoin)
```

# Join Data
Let's see if we can join the eligible position data (Yahoo) with the projection data (Fangraphs).

```{r}
yahoo <- readRDS('data/players_position_eligibility.Rds') %>%
  select(name.full, display_position, positions) %>%
  mutate(name.full = chartr("áéóíñú", "aeoinu", name.full))

yahoo$name.full[yahoo$name.full == 'Daniel Vogelbach'] <- "Dan Vogelbach"
yahoo$name.full[yahoo$name.full == 'Shohei Ohtani (Batter)'] <- "Shohei Ohtani"

fangraphs <- readRDS('data/z_compare_adj.Rds')

fangraphs$Name[fangraphs$Name == 'Enrique Hernandez'] <- "Kike Hernandez"
fangraphs$Name[fangraphs$Name == 'Cedric Mullins II'] <- "Cedric Mullins"
fangraphs$Name[fangraphs$Name == 'Michael Soroka'] <- "Mike Soroka"
fangraphs$Name[fangraphs$Name == 'Nathaniel Lowe'] <- "Nate Lowe"
fangraphs$Name[fangraphs$Name == 'Nathan Karns'] <- "Nate Karns"

df_raw <- fangraphs %>%
  full_join(yahoo, by = c("Name" = "name.full"))

df_fuzzy <- fangraphs %>%
  stringdist_full_join(yahoo, by = c("Name" = "name.full"))

df_raw %>% 
  count(is.na(display_position) & is.na(positions))
df_fuzzy %>% 
  count(is.na(display_position) & is.na(positions))
```

#### Orphaned Records after join fixes
1. Replaced accented characters to characters without accents
2. Fuzzy join
3. Yahoo API query for *2500* players (rather than 850)
4. Duplicate Shohei Ohtani records, lack of pitching projections
5. Multiple player minor name mismatches


```{r}
df_fuzzy %>% 
  filter(is.na(display_position) & is.na(positions)) %>%
  View()

yahoo %>% filter("Riley" %>% grepl(name.full))
fangraphs %>% filter("Riley" %>% grepl(Name)) %>% select(Name)
```

### To Do
1. Missing joins in yahoo data (i.e. Jose Ramirez) due to inconsistent accent marks on letters (and maybe other causes too?)
2. Develop tiers of players (linear model? nearest neighbor?)
3. Replacement level stuff (new section)
4. Take averages of multiple projection sources? 
5. Build team stats based on selections, available players per round? 