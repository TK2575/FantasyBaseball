---
title: "Optimal Lineup"
author: "Tom Kain"
date: "July 6, 2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(glue)
library(plotly)

source("R/helper.R")
```


```{r}
rosters <- load_players_with_projections()

rosters_by_position <- row_per_position(rosters)
```

```{r}

team <- rosters_by_position %>% 
  filter(team == "Deez Nuts")

positions <- c("C","1B","2B","3B","SS","LF","CF","RF","Util")

```


```{r}
batters <- team %>%
  filter(type == "batter") %>% 
  select(team, player_id, name_full, position, pos_zar, zar) %>% 
  arrange(zar %>% desc(), pos_zar %>% desc) 
  

batter_ids <- batters$player_id %>% 
  as_factor() %>%
  levels()

team_result <- tibble(
  position = positions,
  player_id = NA
)

i <- 1

```
```{r}

batter_id <- batter_ids[i]

batter <- batters %>% 
  filter(player_id == batter_id)

batters <- batters %>% 
  add_row(
    team = team$team[1],
    player_id = batter$player_id[1],
    name_full = batter$name_full[1],
    position = "Util",
    pos_zar = -100,
    zar = batter$zar[1]
  ) %>% 
  arrange(zar %>% desc(), pos_zar %>% desc)

for (j in 1:length(batter$position)) {
  if (team_result$player_id[team_result$position == batter$position[j]] %>% is.na()) {
    batter_id -> team_result$player_id[team_result$position == batter$position[j]]
    print(paste0("Assigned ",batter$name_full," to ",batter$position[j]))
    
    break
  }
}

if (!batter_id %in% (team_result$player_id %>% as_factor() %>% levels())) {
  if (team_result$player_id[team_result$position == "Util"] %>% is.na()) {
    batter_id -> team_result$player_id[team_result$position == "Util"]
  }
  else {
    print(paste0("sending batter_id ", batter_id, " to bench"))
  }
}

i <- i+1

result <- batters %>% 
  mutate(position = as.character(position)) %>% 
  inner_join(team_result, c("player_id","position"))

result
```

```{r}
result %>% 
  mutate(pos_zar = if_else(
    position == "Util",
    zar,
    pos_zar
  ))
```